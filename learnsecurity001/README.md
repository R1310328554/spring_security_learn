二、Spring-CORS规则基础配置

想在Spring或Spring Boot的web环境下实现跨域资源共享，主要有三种实现方式：

    @CrossOrigin注解，这个注解是作用于Controller类或者请求方法上的，实现局部接口的跨域资源共享。 实现WebMvcConfigurer接口addCorsMappings方法，实现全局配置的跨域资源共享。 注入CorsFilter过滤器，实现全局配置的跨域资源共享。推荐使用。 

这三种实现方式在我的另外一篇文章《SpringBoot解决跨域访问的问题》中已经介绍过，这里就不多做说明了。
三、Spring Security 中的配置CORS

当我们的应用使用了Spring Security之后，我们会发现上面的配置方法全部失效。此时需要在spring security的WebSecurityConfigurerAdapter中的configure(HttpSecurity http)配置方法，加上http.cors()配置，第二小节中的配置才会生效。


--
CORS 
CORS是一个W3C标准，全称是"跨域资源共享"（Cross-origin resource sharing）。它允许浏览器向跨源(协议 + 域名 + 端口)服务器，发出XMLHttpRequest请求，从而克服了AJAX只能同源使用的限制。

CORS需要浏览器和服务器同时支持。它的通信过程，都是浏览器自动完成，不需要用户参与。对于开发者来说，CORS通信与同源的AJAX通信没有差别，代码完全一样。浏览器一旦发现AJAX请求跨源，就会自动添加一些附加的头信息，有时还会多出一次附加的请求，但用户不会有感觉。
因此，实现CORS通信的关键是服务器。只要服务器实现了对CORS的支持，就可以跨源通信。

所谓‘跨域资源共享’，就是说，我这个域所在服务器中的资源 允许其他域的服务器来进行访问，即共享给其他域！


---
CRSF  
CSRF的全称是(Cross Site Request Forgery)，可译为跨域请求伪造，是一种利用用户带登录 态的cookie迚行安全操作的攻击方式。CSRF实际上并不难防，但常常被系统开发者忽略，从而埋下巨 大的安全隐患。

用户登录A网站后，访问B网站，B网站的某个网页请求A网站的资源； 

 CSRF攻击攻击原理及过程如下：

       1. 用户C打开浏览器，访问受信任网站A，输入用户名和密码请求登录网站A；

       2.在用户信息通过验证后，网站A产生Cookie信息并返回给浏览器，此时用户登录网站A成功，可以正常发送请求到网站A；

       3. 用户未退出网站A之前，在同一浏览器中，打开一个TAB页访问网站B；

       4. 网站B接收到用户请求后，返回一些攻击性代码，并发出一个请求要求访问第三方站点A；


       5. 浏览器在接收到这些攻击性代码后，根据网站B的请求，在用户不知情的情况下携带Cookie信息，向网站A发出请求。网站A并不知道该请求其实是由B发起的，所以会根据用户C的Cookie信息以C的权限处理该请求，导致来自网站B的恶意代码被执行。 
       
3.如何防御CSRF

1.提交验证码
在表单中增加一个随机的数字或字母验证码，通过强制用户和应用进行交互，来有效地遏制CSRF攻击。

2.Referer Check
检查如果是非正常页面过来的请求，则极有可能是CSRF攻击。

3.token验证

    在 HTTP 请求中以参数的形式加入一个随机产生的 token，并在服务器端建立一个拦截器来验证这个 token，如果请求中没有
    token 或者 token 内容不正确，则认为可能是 CSRF 攻击而拒绝该请求。
    token需要足够随机
    敏感的操作应该使用POST，而不是GET，以form表单的形式提交，可以避免token泄露。

4.在 HTTP 头中自定义属性并验证
这种方法也是使用 token 并进行验证，这里并不是把 token 以参数的形式置于 HTTP 请求之中，而是把它放到 HTTP 头中自定义的属性里。通过 XMLHttpRequest 这个类，可以一次性给所有该类请求加上 csrftoken 这个 HTTP 头属性，并把 token 值放入其中。这样解决了上种方法在请求中加入 token 的不便，同时，通过 XMLHttpRequest 请求的地址不会被记录到浏览器的地址栏，也不用担心 token 会透过 Referer 泄露到其他网站中去。
————————————————
版权声明：本文为CSDN博主「ymark_」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：https://blog.csdn.net/u013934914/article/details/50428869



CORS 和 CSRF 区别

    CORS(Cross Origin Resource Sharing)跨域资源分享

CORS是一种机制，通过在HTTP响应头中加入特定字段限制不同域的资源请求CSRF(Cross Site Request Forgery)跨站请求伪造

    CSRF(Cross Site Request Forgery)跨站请求伪造

CSRF 是一种web攻击手段，通过向服务器发送伪造请求，进行恶意行为的攻击手段
————————————————
版权声明：本文为CSDN博主「myli92」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：https://blog.csdn.net/myli92/article/details/124739338


CSRF攻击分类
CSRF漏洞一般分为站外和站内两种类型。
CSRF站外类型的漏洞本质上就是传统意义上的外部提交数据问题。通常程序员会考虑给一些留言或者评论的表单加上水印以防止SPAM问题（这里，SPAM可以简单的理解为垃圾留言、垃圾评论，或者是带有站外链接的恶意回复），但是有时为了提高用户的体验性，可能没有对一些操作做任何限制，所以攻击者可以事先预测并设置请求的参数，在站外的Web页面里编写脚本伪造文件请求，或者和自动提交的表单一起使用来实现GET、POST请求，当用户在会话状态下点击链接访问站外Web页面，客户端就被强迫发起请求。
CSRF站内类型的漏洞在一定程度上是由于程序员滥用


Cors 是共享， Csrf 是攻击； Cors做好了，其实就一定程度防止了 csrf；
为什么需要做Cors ？ 因为其实默认 跨域访问是被浏览器限制的， 不是随便你一个什么网站A想在本网站的某网页 访问其他网站B都是可以的。如果B网站没有给A做资源共享， 那么A 是无法发请求给B 的

默认一个网站不允许共享资源给其他网站，即 A 是无法发请求给B； 那么 csrf 又是怎么来的？ 

原来 img、 script 等元素是可以 默认就是发起跨域请求的。—— 他们发起跨域get请求的时候，会携带cookie吗？ 不会的..  不过发现有些 图片的跨域get请求 也是携带有cookie; todo



是不是只要防止 跨域post请求就可以了呢？ 


